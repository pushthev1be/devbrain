{"type":"PRINCIPLE","id":"p.controllers_thin","text":"Controllers are thin; orchestration lives in services.","tags":["architecture","backend"]}
{"type":"PRINCIPLE","id":"p.fail_fast","text":"Validate inputs at API boundaries and fail fast with clear error messages.","tags":["architecture","api"]}
{"type":"PRINCIPLE","id":"p.single_source_truth","text":"Database is the single source of truth; cache and derived data must be rebuildable.","tags":["architecture","database"]}
{"type":"PRINCIPLE","id":"p.daemon_watch","text":"File watchers should debounce changes and queue analysis to avoid overwhelming the system.","tags":["devbrain","performance"]}
{"type":"PRINCIPLE","id":"p.knowledge_append_only","text":"Knowledge base should be append-only; never edit old entries, version them instead.","tags":["devbrain","knowledge"]}
{"type":"PATTERN","id":"pat.two_phase_delete.v1","name":"Two-phase delete","when":"External asset + local DB","steps":["delete external resource","verify deletion succeeded","delete DB record","invalidate cache"],"tags":["consistency","storage"]}
{"type":"PATTERN","id":"pat.retry_with_backoff.v1","name":"Retry with exponential backoff","when":"External API calls that may fail transiently","steps":["try request","on failure wait 2^attempt seconds","retry up to max_attempts","log final failure"],"tags":["reliability","api"]}
{"type":"PATTERN","id":"pat.pagination_standard.v1","name":"Standard pagination","when":"Listing resources","steps":["accept page and limit params","validate limit <= max","return {items, total, page, limit}","include next/prev URLs"],"tags":["api","ux"]}
{"type":"PATTERN","id":"pat.file_analysis_debounce.v1","name":"Debounced file analysis","when":"Watching files for changes","steps":["set debounce timeout (2s)","on file change clear previous timeout","create new timeout","on timeout fire analysis"],"tags":["devbrain","performance","daemon"]}
{"type":"PATTERN","id":"pat.error_pattern_matching.v1","name":"Error pattern matching with database","when":"Command fails in terminal","steps":["capture error output","search database for similar errors","extract patterns from error","rank solutions by confidence"],"tags":["devbrain","error-handling"]}
{"type":"PATTERN","id":"pat.anti_pattern_detection.v1","name":"Anti-pattern detection in code","when":"Analyzing source code during file watch","steps":["check for callback nesting (>3 promise chains)","check file complexity (>300 lines)","check missing error handling (async without try-catch)","log all detected issues"],"tags":["devbrain","code-analysis"]}
{"type":"PATTERN","id":"pat.github_knowledge_import.v1","name":"Learn from GitHub repositories","when":"Building knowledge from open source","steps":["fetch recent commits","parse commit messages for patterns","fetch closed issues for mistakes","extract root causes","save with confidence scoring"],"tags":["devbrain","github","ai"]}
{"type":"MISTAKE","id":"m.auth_bypass.2025-10-16","symptom":"Login bypass via demo path","root_cause":"Fallback demo token was still active in production","fix_steps":["require JWT on all protected routes","remove demo fallback code","add auth integration tests"],"tags":["auth","security"]}
{"type":"MISTAKE","id":"m.sql_injection.2025-10-15","symptom":"User input in raw SQL query","root_cause":"Used string interpolation instead of parameterized queries","fix_steps":["replace with parameterized queries","audit all DB calls","add SQL injection tests"],"tags":["security","database"]}
{"type":"MISTAKE","id":"m.race_condition_wallet.2025-10-14","symptom":"Double-spend in wallet system","root_cause":"No transaction isolation on balance checks","fix_steps":["wrap check+update in DB transaction","use SELECT FOR UPDATE","add concurrency tests"],"tags":["database","concurrency","wallet"]}
{"type":"MISTAKE","id":"m.cors_blocked.2025-10-13","symptom":"Frontend cannot call backend API","root_cause":"CORS not configured for production domain","fix_steps":["add production domain to allowed origins","test from actual deployed frontend","document CORS settings"],"tags":["deployment","api","cors"]}
{"type":"MISTAKE","id":"m.env_vars_missing.2025-10-12","symptom":"Deployed app crashes on startup","root_cause":"Environment variables not set in production","fix_steps":["document all required env vars in README","add startup validation","fail fast with clear error message"],"tags":["deployment","config"]}
{"type":"MISTAKE","id":"m.daemon_analysis_timeout.2025-02-18","symptom":"Daemon hangs analyzing large files","root_cause":"No timeout on file analysis, unbounded regex matching","fix_steps":["add file size limits","set analysis timeout (5s)","queue large files separately","log timeout warnings"],"tags":["devbrain","daemon","performance"]}
{"type":"MISTAKE","id":"m.api_key_exposed.2025-02-18","symptom":"GitHub detected exposed API credentials in git history","root_cause":".env.local committed to repository","fix_steps":["regenerate all exposed keys immediately","add .env files to .gitignore","use git-secrets or pre-commit hooks","audit git history"],"tags":["security","secrets","devops"]}
{"type":"MISTAKE","id":"m.empty_catch_blocks.2025-02-18","symptom":"Silent failures make debugging impossible","root_cause":"try-catch blocks that swallow errors without logging","fix_steps":["log all caught exceptions","re-throw non-recoverable errors","add context to error messages","use chalk for error visibility"],"tags":["error-handling","logging","devbrain"]}
{"type":"RUNBOOK","id":"rb.add_endpoint.v1","title":"Add new API endpoint","steps":["define route in routes file","implement service method with business logic","add input validation","write unit tests","add to API documentation","update bible with any patterns"],"tags":["api","development"]}
{"type":"RUNBOOK","id":"rb.deploy_backend.v1","title":"Deploy backend to production","steps":["run tests locally","update dependencies in pyproject.toml","commit and push changes","deploy using deploy tool","check logs for errors","test deployed endpoints"],"tags":["deployment","backend"]}
{"type":"RUNBOOK","id":"rb.investigate_bug.v1","title":"Investigate production bug","steps":["collect error logs and reproduce steps","search bible for similar mistakes","add logging if needed","fix root cause not symptoms","add regression test","document as MISTAKE in bible"],"tags":["debugging","process"]}
{"type":"RUNBOOK","id":"rb.add_to_devbrain.v1","title":"Add new feature to DevBrain","steps":["update packages/core/src/types.ts if needed","implement in packages/cli/src/daemon.ts or index.ts","add API endpoint in packages/cli/src/server.ts","update dashboard in apps/dashboard/App.tsx","test endpoint with curl","document in README.md","commit and push"],"tags":["devbrain","development"]}
{"type":"RUNBOOK","id":"rb.devbrain_workflow.v1","title":"DevBrain 3-terminal workflow","steps":["Terminal 1: npm run cli:dev -- daemon --path ./src","Terminal 2: npm run cli:dev -- server --port 3000","Terminal 3: npm run dev (dashboard at localhost:5173)","Monitor daemon output for analysis","Check dashboard TTY tab for errors","Use dashboard to view captured knowledge"],"tags":["devbrain","setup"]}
{"type":"DECISION","id":"d.storage_choice.2025-10","question":"Where to store user uploads?","decision":"Cloud vendor X with CDN","reason":"Built-in CDN, automatic lifecycle policies, and better pricing than alternatives","tags":["infra","storage"]}
{"type":"DECISION","id":"d.framework_fastapi.2025-10","question":"Which Python web framework?","decision":"FastAPI","reason":"Built-in async support, automatic OpenAPI docs, and excellent type hints integration","tags":["backend","framework"]}
{"type":"DECISION","id":"d.database_postgres.2025-10","question":"Which database for main data?","decision":"PostgreSQL","reason":"ACID compliance, JSON support, mature ecosystem, and excellent performance","tags":["database","infra"]}
{"type":"DECISION","id":"d.devbrain_sqlite.2025-02-18","question":"What database for local knowledge storage?","decision":"SQLite with files table + anti_patterns table","reason":"Zero setup, local file, ACID guarantees, append-only design","tags":["devbrain","database"]}
{"type":"DECISION","id":"d.devbrain_monorepo.2025-02-18","question":"How to structure DevBrain project?","decision":"Monorepo with packages/ (core, cli) and apps/ (dashboard, vscode-extension)","reason":"Shared types, single version control, easier dependency management","tags":["devbrain","architecture"]}
{"type":"DECISION","id":"d.error_matching_database.2025-02-18","question":"How to surface solutions when errors occur?","decision":"Search SQLite fixes table for similar error patterns","reason":"Instant access, no external API, accumulates knowledge over time","tags":["devbrain","error-handling"]}
